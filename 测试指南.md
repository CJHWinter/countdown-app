# 🧪 自动化功能测试指南

## 测试目的

验证从B站下载音乐/视频后，自动分类和列表更新功能是否正常工作。

---

## 🔧 测试前准备

### 1. 环境检查

```bash
# 检查 Python
python --version
# 应显示: Python 3.x.x

# 检查 Node.js
node --version
# 应显示: v14.x.x 或更高

# 检查 Flask 依赖
pip list | findstr flask
# 应显示: flask, flask-cors
```

### 2. 启动服务

双击运行：**`启动服务器.bat`**

应该看到两个命令行窗口：
- 窗口1：B站下载器后端（Flask，端口5000）
- 窗口2：倒计时前端服务器（Python HTTP Server，端口8000）

### 3. 访问应用

在浏览器中访问：`http://localhost:8000`

---

## ✅ 测试用例

### 测试用例1：基本流程测试

**目标**：验证完整的自动化流程

**步骤**：
1. 点击右上角 ⚙️ 设置按钮
2. 找到"音乐设置"部分
3. 点击 **🎬 从B站添加音乐/视频** 按钮
4. 等待下载器界面加载（约2-3秒）
5. 输入测试链接（建议使用短视频）：
   ```
   https://www.bilibili.com/video/BV1xx411c7mD
   ```
6. 点击"获取信息"
7. 选择"最低质量"（节省时间）
8. 点击"开始下载"
9. 等待下载完成（观察进度条）
10. **关键步骤**：下载完成后应自动弹出分类选择框
11. 点击 **📚 学习音乐** 按钮
12. 观察提示信息：
    - "正在移动文件..."
    - "文件已移动到学习音乐文件夹"
    - "正在更新音乐列表..."
    - "音乐列表已更新！"
13. 等待约2秒，分类选择框自动关闭
14. 关闭B站下载器弹窗
15. 切换到"专注模式"
16. 查看学习音乐列表，应该能看到新下载的文件

**预期结果**：
- ✅ 分类选择框自动弹出
- ✅ 文件成功移动到 `music/学习/` 文件夹
- ✅ 音乐列表自动更新
- ✅ 新音乐出现在学习音乐列表中
- ✅ 可以正常播放

---

### 测试用例2：休息音乐分类

**目标**：验证移动到休息音乐文件夹

**步骤**：
1. 重复测试用例1的步骤1-10
2. 在分类选择框中点击 **🌸 休息音乐** 按钮
3. 观察提示信息
4. 切换到"休息模式"
5. 查看休息音乐列表

**预期结果**：
- ✅ 文件成功移动到 `music/休息/` 文件夹
- ✅ 新音乐出现在休息音乐列表中

---

### 测试用例3：跳过分类

**目标**：验证跳过功能

**步骤**：
1. 重复测试用例1的步骤1-10
2. 在分类选择框中点击 **⏭️ 跳过，稍后手动移动** 按钮
3. 观察提示信息
4. 打开文件夹：`爬取B站原视频/downloads/`
5. 确认文件仍在该文件夹中

**预期结果**：
- ✅ 分类选择框关闭
- ✅ 显示提示："文件保存在 downloads 文件夹，请稍后手动移动"
- ✅ 文件保留在 downloads 文件夹
- ✅ 音乐列表未更新

---

### 测试用例4：文件名冲突处理

**目标**：验证同名文件的处理

**步骤**：
1. 下载一个视频并移动到"学习音乐"
2. 再次下载**同一个视频**
3. 再次选择"学习音乐"
4. 检查 `music/学习/` 文件夹

**预期结果**：
- ✅ 第二个文件自动重命名为：`文件名(1).mp4`
- ✅ 两个文件都存在，没有被覆盖
- ✅ 音乐列表中显示两个文件

---

### 测试用例5：错误处理测试

**目标**：验证错误情况的处理

#### 5.1 后端服务未启动
**步骤**：
1. 关闭Flask后端窗口
2. 尝试点击分类按钮

**预期结果**：
- ✅ 显示错误提示："操作失败: Failed to fetch"

#### 5.2 Node.js未安装
**步骤**：
1. 临时重命名 `node.exe`（模拟未安装）
2. 下载视频并选择分类

**预期结果**：
- ✅ 文件移动成功
- ✅ 显示警告："文件已移动，但音乐列表更新失败"

#### 5.3 无效的视频链接
**步骤**：
1. 输入无效链接
2. 尝试下载

**预期结果**：
- ✅ 显示错误提示
- ✅ 不会弹出分类选择框

---

### 测试用例6：跨窗口通信测试

**目标**：验证主应用接收消息并刷新

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 下载视频并选择分类
4. 观察控制台输出

**预期结果**：
- ✅ B站下载器控制台显示：
  ```
  正在移动文件...
  文件已移动到学习音乐文件夹
  正在更新音乐列表...
  音乐列表已更新！
  ```
- ✅ 主应用控制台显示：
  ```
  🎵 收到音乐更新通知: {type: 'music_updated', category: 'study', ...}
  🎵 开始加载音乐文件...
  ✅ 从 music-list.json 加载音乐列表：学习XX首，休息XX首
  ```

---

### 测试用例7：UI响应测试

**目标**：验证界面元素和动画

**步骤**：
1. 下载完成后，观察分类选择框
2. 检查以下元素：
   - 文件名显示
   - 文件大小显示
   - 两个分类按钮
   - 跳过按钮
   - 头部渐变色
   - 底部提示文字

**预期结果**：
- ✅ 所有元素正确显示
- ✅ 文件名和大小准确
- ✅ 滑入动画流畅
- ✅ 按钮悬停效果正常
- ✅ 毛玻璃背景效果可见

---

### 测试用例8：性能测试

**目标**：验证大文件处理

**步骤**：
1. 下载一个大文件（100MB+）
2. 选择分类
3. 计时整个处理过程

**预期结果**：
- ✅ 文件移动时间 < 5秒
- ✅ 脚本执行时间 < 5秒
- ✅ 界面刷新时间 < 2秒
- ✅ 总处理时间 < 15秒

---

## 📊 测试结果记录

### 测试环境

| 项目 | 信息 |
|------|------|
| 操作系统 | Windows 10 |
| Python版本 | 3.x.x |
| Node.js版本 | v14.x.x |
| 浏览器 | Chrome/Edge |
| 测试日期 | 2025-11-07 |

### 测试结果表

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1. 基本流程测试 | ⬜ 待测试 | |
| 2. 休息音乐分类 | ⬜ 待测试 | |
| 3. 跳过分类 | ⬜ 待测试 | |
| 4. 文件名冲突处理 | ⬜ 待测试 | |
| 5. 错误处理测试 | ⬜ 待测试 | |
| 6. 跨窗口通信测试 | ⬜ 待测试 | |
| 7. UI响应测试 | ⬜ 待测试 | |
| 8. 性能测试 | ⬜ 待测试 | |

---

## 🐛 已知问题

### 问题1：[待发现]
**描述**：  
**重现步骤**：  
**预期行为**：  
**实际行为**：  
**解决方案**：  

---

## 💡 测试建议

### 推荐测试视频

使用短小的测试视频可以节省时间：

1. **短视频**（< 10MB）：
   - 用于快速功能测试
   - 建议选择"最低质量"

2. **中等视频**（10-50MB）：
   - 用于常规场景测试
   - 模拟真实使用情况

3. **大视频**（> 50MB）：
   - 用于性能测试
   - 验证大文件处理能力

### 测试技巧

1. **使用开发者工具**：
   - F12 打开控制台
   - 观察网络请求
   - 查看错误信息

2. **检查文件系统**：
   - 确认文件是否真正移动
   - 检查 `music-list.json` 是否更新

3. **多浏览器测试**：
   - Chrome（推荐）
   - Edge
   - Firefox

4. **清理测试数据**：
   - 定期清理 downloads 文件夹
   - 删除测试用的音乐文件

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试日期**：2025-11-07  
**测试人员**：[姓名]  
**测试环境**：Windows 10 + Chrome  

### 测试总结
- 总用例数：8
- 通过数：X
- 失败数：X
- 通过率：XX%

### 主要发现
1. [问题描述]
2. [问题描述]

### 建议
1. [改进建议]
2. [改进建议]

### 结论
✅ 功能正常，可以发布  
或  
❌ 存在问题，需要修复
```

---

## 🎉 测试完成检查清单

- [ ] 所有测试用例已执行
- [ ] 测试结果已记录
- [ ] 已知问题已文档化
- [ ] 性能指标符合预期
- [ ] UI/UX 体验良好
- [ ] 错误处理完善
- [ ] 文档已更新
- [ ] 准备好发布

---

**版本**: 1.0.0  
**更新日期**: 2025-11-07

